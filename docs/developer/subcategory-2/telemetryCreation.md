---
date: 2018-11-18
title: Creation.
description: This is a Guide for developers who are interested to write a plugin for OPenRAP (v2.0) 
PageOrdering: 2
showSidebar: true
published: true
allowSearch: true
allowIndexing: true
---
## Creation:
This module will primarily focus on creating telemetry from the OpenRAP device, consumed by OpenRAP application itself or by other applications as well who wish to use telemetry generated by the OpenRAP device and drive some analytics on top of that.

The telemetry collector is a service which will be running in the background. It continuously listens to the below said events and writes logs onto a circular buffer memory.

The telemetry data which is extracted from the OpenRAP device can be classified into two groups: viz., Device-Specific Telemetery and User-Specific Telemetry.

1. **Device-Specific Telemetry**  
    * **Device Came up** - Logging on whenever the device comes up, the time for it. **(Event: START)**
    * **Device got internet connectivity** - Time when the device gets connected to the internet. **(Event: LOG)**
    * **Got IP address** - Device Got IP address with the IP address **(Event: LOG)**
    * **USB/Peripherals inserted/removed** - Logging whenever any peripheral is inserted/removed. **(Event: INTERRUPT)**
    * **CPU crossed the threshold** - Logging whenever CPU usage crosses the threshold (95%) **(Event: ERROR)**
    * **Memory crossed the threshold** - Logging whenever memory crosses the threshold (95%) **(Event: ERROR)**
    * **Bandwidth crossed the threshold** - Logging whenever Bandwidth crosses the threshold (95%) **(Event: ERROR)**
    * **OpenRAP and related Application/services** (OpenRAP, dev-mgmt,  telemetry, search service) start/stop. **(Event: START)**
    * **Hostapd (WiFi Hotspot) logs and errors**
        * Device moving to AP mode with SSID **(Event: LOG)**
        * Clients connecting to OpenRAP device with Client IP Addr, MAC addr, it's hardware build and running OS (If possible)**(Event: LOG)**
    * **Device<->cloud sync-up details***
        * Last sync Time, along with cloud details and files synced. **(Event: LOG)**
2. **Users Specific Telemetry**
    * Tracking Admin users log in and activities on the Dev-mgmt page like
        * Added/Deleted content (including folders and files) **(Event: LOG)**
            * SSID Change **(Event: AUDIT)**
            * Added another user. **(Event: LOG)**
            * Changed permission of the user. **(Event: AUDIT)**
        * End-user/clients activities details with respect to content.
            * Content usage by clients having details like content ID, Name, Size of the content. **(Event: LOG)**
            * The search performed by user and the corresponding number of matches from the search query. **(Event: SEARCH)**

Applications can ask for telemetry logs for time duration and will get the data in the below-mentioned format.

### Format:
OpenRAP will be using the same generic envelope with some customization if required. Below mentioned are the events and Generic Envelopes. Let's map each of the events discussed above to one of the generic events in the below list. 
Kindly refer to [https://github.com/ekstep/Common-Design/wiki/Telemetry-V3](https://github.com/ekstep/Common-Design/wiki/Telemetry-V3) for the Generic Telemetry Envelope.

#### Events:
* [START](https://github.com/ekstep/Common-Design/wiki/Telemetry-V3#start) - Start of a multi-step activity. For ex: Session, App, Tools, Community, etc would have start and end
* [END](https://github.com/ekstep/Common-Design/wiki/Telemetry-V3#end) - End of a workflow
* [IMPRESSION]() - A visit to a specific page by a user
* [INTERACT]() - User interaction on the page (such as search, click, preview, move, resize, configure)
* [ASSESS]() - An assessment has happened during content play
* [RESPONSE]() - To capture a user response. For ex: Responded to a poll or a calendar event or a question
* [INTERRUPT]() - An interrupt triggered the app (such as mobile app sent to background)
* [FEEDBACK]() - Feedback provided
* [SHARE]() - When any file-sharing happens. For ex: Share content, telemetry data, link, file, etc
* [AUDIT]() - When an object is changed. This includes lifecycle changes as well.
* [ERROR]() - When an error has occurred.
* [HEARTBEAT]() - An heartbeat event to denote that the process is running.
* [LOG]() - Generic log event. API call, Service call, app update, etc.
* [SEARCH]() - A search is triggered (content, item, asset, etc.)
* [METRICS]() - Service business metrics (also accessible via health API.)
* [SUMMARY]() - A summary event.
* [EXDATA]() - A generic wrapper event to capture encrypted/serialized data.

#### Envelope:
```css
{
    // About the event
    "eid": , Event ID (Ex.(START), (END), (LOG))// Required.
    "ets": , // Required. Epoch timestamp of event (time in milli-seconds. For ex: 1442816723)
    "ver": , // Required. Version of the event data structure, currently "3.0"
    "mid": , // Required. Unique message ID. Used for deduplication, replay and update indexes
    // Who did the event
    actor": { // Required. Actor of the event (usually it will be root user of the OpenRAP device which will be root)
        "id": , // Required. ID of the user that produced the event
        "type":  // Optional. Can be blank. Type of the device that the event was triggered on
    },

    // Context of the event
    "context": { // Required. Context in which the event has occurred (OpenRAP).
        "channel": , // Required. Channel which has produced the event (OpenRAP)
        "pdata": { // Optional. Producer of the event
            "id": , // Required. Device ID of the OpenRAP device
                "pid": , // Required. (PID of the application producing the event)
                "ver":  // Required. version number of theOpenRAP build
        },
        "env": , // Required. Unique environment where the event has occured. (Profile name of the application)
        "sid": , // Optional. Session id of the requestor stamped by portal
        "did": , // Optional. uuid of the device, created during app installation
        "cdata": [{ // Optional. Correlation data
            "type":"", // Optional. Used to indicate action that is being correlated
            "id": "" // Optional. The correlation ID value
        }],
        "rollup": { // Optional. Context rollups
            "l1": "",
            "l2": "",
            "l3": "",
            "l4": ""
        }
    },
    
    // What is the target of the event
    "object": { // Optional. Object which is the subject of the event.
        "id": , // Required. Id of the object. For ex: content id incase of content
        "type": , // Required. Type of the object. For ex: "Content", "Community", "User" etc.
        "ver": , // Optional. Version of the object
        "rollup": { // Optional. Rollups to be computed of the object. Only 4 levels are allowed.
            "l1": "",
            "l2": "",
            "l3": "",
            "l4": ""
        }
    },
    
    // What is the event data
    "edata": {
        // Apart from the following generic structure, there are event specific structures which can be found further in the documentation.
        Sub-Event : (Required) Event performed.
        Value: (Required) Value associated with the event, we might have to define value structure for all the events defined above. As an example 
        Sub-Event: Client joined OpenRAP device.
        Value: {
        MAC: xxxxyyyyzzzz
        Ip: 192.192.192.192
        OS: 
        Make:
        }
        Actor : (Optional) Actor performing the event or on which the event was performed.
        Actor Details: (Optional) Details of the actor, like its IP addr, Mac Addr. 
        As an example:
        Event: Client consumed content
        Value: {
            Content Name:
            Content Size:
            Content Location:
            Content Author:
        }
        Actor : {
            IP: 
            MAC:
        }
    } // Required.

    // Tags
    "tags": [""] // Optional. Encrypted dimension tags passed by respective channels
}
```
### Event Definitions
Following sections provide exact event specific structures edata for the aforementioned events.

#### Device specific telemetry
* Device came up (START)
    ```css
    {
        "edata": {
            "type": "os", // Required. app, session,editor, player, workflow, assessment
            "dspec": "", // Device specification object
            "mode": "bootup", // Optional. Mode of start. For "player" it would be "play/edit/preview". For workflow it would be Review/Flag/Publish. For editor it could be "content", "textbook", "generic","lessonplan" etc
            "duration": "", // Optional. System up time
        }
    }
    ```
* Device got internet connectivity (LOG)
    ```css    
    {
        "edata": {
            "type": "system", // Required. Type of log(system, process, api_access, api_call, job,app_update, etc)
            "level": "INFO", // Required. Level of the log. TRACE, DEBUG, INFO, WARN, ERROR, FATAL
            "message": "Established internet connectivity", // Required. Log message
            "params": [
                {
                    "timestamp": ""
                }
            ] // Optional. Additional params in the log message
        }
    }
    ```
* Got IP address (LOG)
    ```css
    {
        "edata": {
            "type": "system", // Required. Type of lo(system, process, api_access, api_call, job,app_update, etc)
            "level": "INFO", // Required. Level of the log.TRACE, DEBUG, INFO, WARN, ERROR, FATAL
            "message": "Received IP address", //Required.Log message
            "params": [
                {    
                    "timestamp": "",
                    "IP": ""
                }
            ] // Optional. Additional params in the log message
        }
    }
    ```
* USB/Peripherals inserted/removed (INTERRUPT)
    ```css
    {
        "edata": {
            "type": "background", // Required.[m:background, m:resume]
        }
    }   
    ```
* CPU crossed threshold (ERROR)
    ```css
    {
        "edata": {
            "err": "CPU consumption over 95%", //Required.  Alternatively, can define errorcodes
            "errtype": "SYSTEM", // Required. Error typeclassification - "SYSTEM", "MOBILEAPP","CONTENT"
            "stacktrace": "", // Required. Detailed error data/stack trace.
        }
    }
    ```
* Memory crossed threshold (ERROR)
    ```css
    {
        "edata": {
            "err": "Memory consumption over 95%", //Required. Alternatively, can define errorcodes
            "errtype": "SYSTEM", // Required. Error typeclassification - "SYSTEM", "MOBILEAPP","CONTENT"
            "stacktrace": "" // Required. Detailed error data/stack trace.
        }
    }
    ```
* Bandwidth crossed threshold (ERROR)
    ```css
    {
        "edata": {
            "err": "Bandwidth consumption over 95%", //Required. Alternatively, can define errorcodes
            "errtype": "SYSTEM", // Required. Error typeclassification - "SYSTEM", "MOBILEAPP","CONTENT"
            "stacktrace": "" // Required. Detailed error data/stack trace.
        }
    }
    ```
* OpenRAP and related Application/services (START)
    ```css
    {
        "edata": {
            "type": "service", // Required. app, session editor, player, workflow, assessment
            "mode": "initiated", // Optional. Mode of start. For "player" it would be "play/edit/preview". For workflow it would be Review/Flag/Publish. For editor it could be "content", "textbook", "generic","lessonplan" etc
            "duration": "" // Optional. Duration for which the service has been running
        }
    }
    ```
* Hostapd (WiFi Hotspot) logs and errors   
    * Device moving to AP mode with SSID (LOG)
        ```css
        {
            "edata": {
                "type": "system", // Required. Type of log (system, process, api_accessapi_call, job, app_update, etc)
                "level": "INFO", // Required. Leve of the log. TRACE, DEBUG, INFO, WAR ERROR, FATAL
                "message": "Switched to AP mode", /Required. Log message
                "params": [
                    {    
                        "timestamp": "",
                        "SSID": ""
                    }
                ] // Optional. Additional params in the log message
            }
        }
        ```
    * Clients connecting to OpenRAP (LOG)
        ```css
        {
            "edata": {
                "type": "process", // Required. Type of log (system, process, api_access, api_cal job, app_update, etc)
                "level": "INFO", // Required. Level of the log. TRACE, DEBUG, INFO, WARN, ERROR, FATAL
                "message": "Established connection with the client", // Required. Log message
                "params": [
                    {    
                        "timestamp": "",
                        "client": {
                            "IP": "",
                            "MAC": ""
                        }
                    }
                ] // Optional. Additional params in the log message
            }
        }
        ```
    * Device sync (LOG)
        ```css 
        {
            "edata": {
                "type": "process", // Required. Type of log(system, process, api_access, api_call, job,app_update, etc)
                "level": "INFO", // Required. Level of the log. TRACE, DEBUG, INFO, WARN, ERROR, FATAL
                "message": "", // Required. Log message (cloud sync initiated, cloud sync complete)
                "params": [
                    {    
                        "timestamp": "",
                        "lastSync": "", // last sync timestamp
                        "files": [], // files synced,
                        "cloudDetails": {}
                    }
                ] // Optional. Additional params in the log message
            }
        }
        ```

#### Users Specific Telemetry
* Tracking Admin users
    * Added/Deleted content (LOG)
        ```css
        {
            "edata": {
                "type": "api_call", // Required. Type of log (system, process, api_access, api_call, job, app_update, etc)
                "level": "INFO", // Required. Level of the log. TRACE, DEBUG, INFO, WARN, ERROR, FATAL
                "message": "Added/deleted file(s)", // Required. Log message
                "params": [
                    {    
                        "timestamp": "",
                        "actor": "",
                        "files": [] // files synced
                    }
                ] // Optional. Additional params in the log message
            }
        }
        ```
    * SSID Change (AUDIT)
        ```css
        {
            "edata": {
                "props": ["ssid"], // Updated properties
                "state": "", // Optional. New SSID
                "prevstate": "" // Optional. Old SSID
            }
        }
        ```
    * Added/Deleted another user (LOG)
        ```css
        {
            "edata": {
                "type": "api_call", // Required. Type of log (system, process, api_access, api_call, job app_update etc)
                "level": "INFO", // Required. Level of the log. TRACE, DEBUG, INFO, WARN, ERROR, FATAL
                "message": "Added/deleted user(s)", // Required. Log message
                "params": [
                    {    
                        "timestamp": "",
                        "actor": "",
                        "userAdded/Deleted" : ""
                    }
                ] // Optional. Additional params in the log message
            }
        }
        ```
    * Changed permission of the user (AUDIT)
        ```css
        {
            "edata": {
                "props": ["permissions"], // Updated properties.
                "state": "", // Optional. New list of permissions
                "prevstate": "" // Optional. Old list of permissions
            }
        }
        ```
* End-user/clients activities
    * Content usage by clients (LOG)  
        ```css
        {
            "edata": {
                "type": "api_call", // Required. Type of log (system, process, api_access, api_call, job, app_update, etc)
                "level": "INFO", // Required. Level of the log. TRACE, DEBUG, INFO, WARN, ERROR, FATAL
                "message": "Client consumed content", // Required. Log message
                "params": [
                    {    
                        "timestamp": "",
                        "uaspec": "", // User Agent specification object
                        "query": "",
                        "results" : {}
                    }
                ] // Optional. Additional params in the log message
            }
        }
        ```
    * Search performed by User (LOG)
        ```css
        {
            "edata": {
                "type": "api_call", // Required. Type of log (system, process, api_access, api_call, job, app_update, etc)
                "level": "INFO", // Required. Level of the log. TRACE, DEBUG, INFO, WARN, ERROR, FATAL
                "message": "Client searched for content", // Required. Log message
                "params": [
                    {    
                        "timestamp": "",
                        "uaspec": "", // User Agent specification object
                        "query": "",
                        "results" : {}
                    }
                ] // Optional. Additional params in the log message
            }
        }
        ```

**SDK APIs:**  

saveTelemetry :-  
**Arguments**
* Any extra telemetry in the decided format that needs to be saved. 

**Description**
* Saves the passed telemetry.